<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- Load required Bootstrap and BootstrapVue CSS -->
        <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap@4.6.1/dist/css/bootstrap.min.css" />

        <!-- Load Vue followed by BootstrapVue -->
        <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
        <script src="https://unpkg.com/bootstrap-vue@2.22.0/dist/bootstrap-vue.min.js"></script>
        <script src="https://unpkg.com/bootstrap-vue@2.22.0/dist/bootstrap-vue-icons.min.js"></script>

        <script src="https://unpkg.com/@popperjs/core@2.11.5/dist/umd/popper.min.js"></script>

        <!-- Load the following for Plotly Graphics -->
        <script src="https://cdn.plot.ly/plotly-2.9.0.min.js"></script>

        <!-- Load Math Package-->
        <script src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>

        <!-- OpenCPU client library -->
        <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script src="https://cdn.opencpu.org/opencpu-0.4.js"></script>

        <!-- Datatable  -->
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
        <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>

        <link type="text/css" rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css"></link>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
        <script src="https://cdn.datatables.net/select/1.3.4/js/dataTables.select.min.js"></script>

        <style>
            html {
                font-size: 0.6rem;
            }
        </style>

        <title>Searchtable</title>
    </head>
    <body>
        <b-container id="App" fluid>
            <b-row>
                <b-col>
                    <b-tabs content-class="mt-3"  no-body>
                        <b-tab title="Data" key="datatable">
                            <table id="data" class="display compact hover" style="width:100%">
                                <thead>
                                    <tr>
                                        <th v-for="col in cols">
                                            {{col}}
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="row in data">
                                        <td v-for="col in cols">
                                            {{row[col]}}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </b-tab>
                    </b-tabs>
                </b-col>
            </b-row>
        </b-container>
    </body>
    <script>
        const dataframe = [{A:1, B:2}, {A:10, B:20},{A:1, B:2}, {A:10, B:20},{A:1, B:2}, {A:10, B:20},{A:1, B:2}, {A:10, B:20},{A:1, B:2}, {A:10, B:20},{A:1, B:2}, {A:10, B:20}, {A:10, B:20},{A:1, B:2}, {A:10, B:20},{A:1, B:2}, {A:10, B:20},{A:1, B:2}, {A:10, B:20}];
        const title = "Test";
        const Mcolor = ["#1dbecf", "#0066b3", "#522f91", "#ffcb08", "#ed174b", "#009a5b", "#ee3897", "#a5ce43", "#e1c1cb", "#95d5d2", "#c3dfa4", "#fedbb4"];
        var cols = Object.keys(dataframe[0]);

        var app = new Vue({
            el: "#App",
            data:{
                data: dataframe,
                title: title,
                cols: cols
            },
            mounted: function(){
                var app = this;

                $('#data thead tr')
                    .clone(true)
                    .addClass('filters')
                    .appendTo('#data thead');
                $(document).ready(function () {
                    var table = $('#data').DataTable({
                        orderCellsTop: true,
                        fixedHeader: true,
                        scrollY: '65vh',
                        scrollX:true,
                        scrollCollapse: true,
                        paging: false,
                        initComplete: function () {
                            var api = this.api();
                
                            // For each column
                            api
                                .columns()
                                .eq(0)
                                .each(function (colIdx) {
                                    // Set the header cell to contain the input element
                                    var cell = $('.filters th').eq(
                                        $(api.column(colIdx).header()).index()
                                    );
                                    var title = $(cell).text();
                                    $(cell).html('<input type="text" placeholder="' + title + '" style="width:100%" />');
                
                                    // On every keypress in this input
                                    $(
                                        'input',
                                        $('.filters th').eq($(api.column(colIdx).header()).index())
                                    )
                                        .off('keyup change')
                                        .on('change', function (e) {
                                            // Get the search value
                                            $(this).attr('title', $(this).val());
                                            var regexr = '({search})'; //$(this).parents('th').find('select').val();
                
                                            var cursorPosition = this.selectionStart;
                                            // Search the column for that value
                                            api
                                                .column(colIdx)
                                                .search(
                                                    this.value != ''
                                                        ? regexr.replace('{search}', '(((' + this.value + ')))')
                                                        : '',
                                                    this.value != '',
                                                    this.value == ''
                                                )
                                                .draw();
                                        })
                                        .on('keyup', function (e) {
                                            e.stopPropagation();
                
                                            $(this).trigger('change');
                                            $(this)
                                                .focus()[0]
                                                .setSelectionRange(cursorPosition, cursorPosition);
                                        });
                                });
                        },
                    });
                    table.on('click', 'tbody tr', (e) => {
                        let classList = e.currentTarget.classList;
                    
                        if (classList.contains('selected')) {
                            classList.remove('selected');
                        }
                        else {
                            table.rows('.selected').nodes().each((row) => row.classList.remove('selected'));
                            classList.add('selected');
                        }
                    });
                });
            },
            methods: {
                
            }
        });
    </script>
</html>