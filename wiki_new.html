
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- Load required Bootstrap and BootstrapVue CSS -->
        <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap@5.1.3/dist/css/bootstrap.min.css" />
        <!-- Load Vue followed by BootstrapVue -->
        <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
        <script src="https://unpkg.com/bootstrap-vue@2.21.2/dist/bootstrap-vue.min.js"></script>
        <script src="https://unpkg.com/bootstrap-vue@2.21.2/dist/bootstrap-vue-icons.min.js"></script>
        <!-- Load the following for Plotly Graphics -->
        <script src="https://cdn.plot.ly/plotly-2.9.0.min.js"></script>
        <!-- Load Math Package-->
        <script src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>
        <!-- OpenCPU client library -->
        <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
        <script src="https://cdn.opencpu.org/opencpu-0.4.js"></script>
        <!-- Datatable  -->
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.css">
        <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
        <link type="text/css" rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css"></link>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
        <script src="https://cdn.datatables.net/select/1.3.4/js/dataTables.select.min.js"></script>
        <title>HTML Template for simple Scatterplot</title>
    </head>
    <body>
        <div id="App" class="container-md">
            <b-row style="height:50px" class="sticky-top">
                <b-col>
                    <input type="text" v-model="mylink"><button @click="stop=true; counter=0;getdata();">Start</button><button @click="stopft">Stop</button><button @click="download">Donwload</button>
                    {{counter}} <br>
                    {{ mylink }} <br> Main index; current status: {{stop}}
                    <input type="text" v-model="file_name">
                    <br><br><br>
                    {{text}}
                </b-col>
            </b-row>
            <b-row sytle="padding-top:55px">
                <b-col></b-col>
            </b-row>
        </div>
    </body>
    <script type="module">
        import { WebR } from 'https://webr.r-wasm.org/latest/webr.mjs';
        const webR = new WebR({ interactive: false });
        await webR.init();
        await webR.installPackages(['curl'], true);

        var app = new Vue({
            el: "#App",
            data:{
                text: "",
                mylink: "https://wikidich.com.vn/so-tay-sinh-ton-danh-cho-nu-phu-o-mat-the/chuong-1-8OD_EGo!XQHN",
                counter: 0,
                stop: true,
                file_name: "wiki_text"
            },
            mounted: function(){
                //console.log(this.mylink);
                //this.getdata();
                console.log("V5");
            },
            methods: {
                stopft: function(){
                    this.stop = false;
                },
                download: function(){
                    // Create a Blob object with the content
                    const uriContent = "data:text/plain;charset=utf-8," + window.encodeURIComponent(this.text + ";\t\t" + this.mylink);
                    const element = document.createElement('a');
                    element.setAttribute('href', uriContent);
                    element.setAttribute('download', this.file_name + ".txt");
                    element.style.display = 'none';
                    document.body.appendChild(element);
                    element.click();
                    document.body.removeChild(element);
                },
                getdata: async function(){
                    var app = this;
                    app.stop = true;
                    var mydata = await webR.evalRString(`
library(curl)
` + "inhalt <- try(scan(curl::curl('" + app.mylink + "', 'r')" + `, sep="\n", quote="", what="character"));
tt <- inhalt[grep('<div class="truyen">', inhalt)]
tt <- gsub('<div class="truyen">', "", tt)
tt <- gsub("<br>", ". ", tt)
tt <- gsub("</div>", ".", tt)
tt <- gsub('"', "'", tt)
tt <- paste(tt, "\n")
nextCh <- inhalt[grep("class='next'", inhalt)][1]
nextCh <- strsplit(nextCh, split="href=\'")[[1]][2]
nextCh <- strsplit(nextCh, split="\' ")[[1]][1]
link <- paste("https://wikidich.com.vn", nextCh, sep="")
paste('{ text=\"', tt,'", link="',link,'"}',sep="")
                    `);
                    var datjson = JSON.parse(mydata);
                    app.text = app.text + data.text[0];
                    app.mylink = data.link[0];
                    app.counter++;
                    if(app.stop && app.counter < 100){
                        setTimeout(() => {
                              app.getdata();
                        }, 2000);
                    }
                }
            }
        });
    </script>
</html>









